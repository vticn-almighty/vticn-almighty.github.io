<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AVL | PTLibrary</title>
    <meta name="description" content="vuepress博客">
    <link rel="icon" href="/hero.png">
    
    <link rel="preload" href="/assets/css/0.styles.ea5c5677.css" as="style"><link rel="preload" href="/assets/js/app.d3fbac6e.js" as="script"><link rel="preload" href="/assets/js/2.8a2063c8.js" as="script"><link rel="preload" href="/assets/js/5.b2285a0a.js" as="script"><link rel="prefetch" href="/assets/js/10.cc899597.js"><link rel="prefetch" href="/assets/js/11.e6717439.js"><link rel="prefetch" href="/assets/js/12.bddf789c.js"><link rel="prefetch" href="/assets/js/13.da6c25e7.js"><link rel="prefetch" href="/assets/js/14.2ad18ced.js"><link rel="prefetch" href="/assets/js/15.7fb66cf2.js"><link rel="prefetch" href="/assets/js/16.bb9f876c.js"><link rel="prefetch" href="/assets/js/17.c15b37cc.js"><link rel="prefetch" href="/assets/js/18.a865ba5c.js"><link rel="prefetch" href="/assets/js/19.d98bf0f4.js"><link rel="prefetch" href="/assets/js/20.014fb71e.js"><link rel="prefetch" href="/assets/js/21.51266ad7.js"><link rel="prefetch" href="/assets/js/22.3d33f141.js"><link rel="prefetch" href="/assets/js/23.fe669eaf.js"><link rel="prefetch" href="/assets/js/24.7b0e6145.js"><link rel="prefetch" href="/assets/js/25.64351012.js"><link rel="prefetch" href="/assets/js/26.99e01c6f.js"><link rel="prefetch" href="/assets/js/27.97d3e7cc.js"><link rel="prefetch" href="/assets/js/28.c08d64a4.js"><link rel="prefetch" href="/assets/js/3.02ad1a1b.js"><link rel="prefetch" href="/assets/js/4.1783c404.js"><link rel="prefetch" href="/assets/js/6.ca781bb6.js"><link rel="prefetch" href="/assets/js/7.ebaa2f05.js"><link rel="prefetch" href="/assets/js/8.74f66f6d.js"><link rel="prefetch" href="/assets/js/9.82df91cd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ea5c5677.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">PTLibrary</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/index/html-css/css.html" class="nav-link">html&amp;css</a></li><li class="dropdown-item"><!----> <a href="/index/javascript/javascript.html" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/index/nodejs/nodejs.html" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/index/python/python.html" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/index/data/data.html" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/index/C++/STL_Container.html" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/index/others/rap2.html" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><a href="/project/project.html" class="nav-link">项目总结</a></div><div class="nav-item"><a href="/practice/practice.html" class="nav-link">小练习</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/422ccfa02512" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/1Crazy/1Crazy.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/index/html-css/css.html" class="nav-link">html&amp;css</a></li><li class="dropdown-item"><!----> <a href="/index/javascript/javascript.html" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/index/nodejs/nodejs.html" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/index/python/python.html" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/index/data/data.html" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/index/C++/STL_Container.html" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/index/others/rap2.html" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><a href="/project/project.html" class="nav-link">项目总结</a></div><div class="nav-item"><a href="/practice/practice.html" class="nav-link">小练习</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/422ccfa02512" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/1Crazy/1Crazy.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>html&amp;css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据结构</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/index/data/data.html" class="sidebar-link">导语</a></li><li><a href="/index/data/bst.html" class="sidebar-link">二叉搜索树</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/index/data/avl.html" class="active sidebar-link">自平衡二叉树</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/data/avl.html#平衡插入数据" class="sidebar-link">平衡插入数据</a></li><li class="sidebar-sub-header"><a href="/index/data/avl.html#平衡删除数据" class="sidebar-link">平衡删除数据</a></li><li class="sidebar-sub-header"><a href="/index/data/avl.html#小结" class="sidebar-link">小结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="avl"><a href="#avl" aria-hidden="true" class="header-anchor">#</a> AVL</h1> <p>由于BST中存在由于插入顺序导致的局部数据深度过深的效率降低风险：</p> <img src="/problem.png" style="width:75%;"> <p>子树的左右侧数据相对数据深度差过大将导致访问较深处数据时需要通过类似线性遍历的方式依次访问各个数据节点，访问效率降低，因此我们需要通过自动平衡将数据的相对深度降到&lt;=1</p> <p>为了清楚的观察AVL的数据分布情况，我开发了基于广度优先搜索(BST)和中序遍历(IOT)的二叉树可视化程序，其中的原理将在接下来的文章中分析，现在我们就通过可视化系统查看BST改良为AVL后的数据分布情况：</p> <img src="/avl1.png" style="width:85%;"> <p>由此可见经过自平衡处理后以13，27为根节点的子树相对高度差为1，假设我们需要访问数据70，那么根据BST的数据结构，我们需要以根节点11为起点访问7次，而通过AVL只需要访问4次，由此可见AVL显著的改善了深数据的访问速度</p> <p>实现二叉树自旋主要考虑四种情况，也对应了四种旋转策略：
<img src="/rotation.jpg" style="width:100%;"></p> <p>这四种方法在程序中是这样实现的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">rotationLL</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;LL&quot;</span><span class="token punctuation">,</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> tmp <span class="token operator">=</span> node<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>left <span class="token operator">=</span> tmp<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    tmp<span class="token punctuation">.</span>right <span class="token operator">=</span> node<span class="token punctuation">;</span>
    <span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">rotationRR</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;RR&quot;</span><span class="token punctuation">,</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>right <span class="token operator">=</span> tmp<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    tmp<span class="token punctuation">.</span>left <span class="token operator">=</span> node<span class="token punctuation">;</span>
    <span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">rotationLR</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;LR&quot;</span><span class="token punctuation">,</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">rotationRR</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">rotationLL</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">rotationRL</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;RL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">rotationLL</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">rotationRR</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="平衡插入数据"><a href="#平衡插入数据" aria-hidden="true" class="header-anchor">#</a> 平衡插入数据</h2> <p>我将对其中左单旋转(RR)这种情况进行分析：</p> <img src="/bst1.png" style="width:60%;"> <p>由图可知，我们的数据90与数据30相对深度差为2，不满足AVL要求的深度差&lt;=1的要求，根据旋转的约定情况，满足RR旋转法则，所以我们自旋后的数据分布是这样的：</p> <img src="/avl2.png" style="width:60%;"> <p>根据RR自旋法则，我们将主树根节点50右侧的子节点70作为新的主树根节点，将70左侧的节点60接入到50的右侧，然后以50为根节点的子树接入到主树根节点70的左侧，这样就完成了平衡</p> <p>我们应该在什么时候进行二叉树的平衡呢，一般是在插入新数据和删除数据的时候，我们逐一进行分析......</p> <p>以下是AVL插入功能的实现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">insertNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">insertNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>left <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>left<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    node <span class="token operator">=</span> <span class="token function">rotationLL</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    node <span class="token operator">=</span> <span class="token function">rotationLR</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&gt;</span> node<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">insertNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>right <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&gt;</span> node<span class="token punctuation">.</span>right<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    node <span class="token operator">=</span> <span class="token function">rotationRR</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    node <span class="token operator">=</span> <span class="token function">rotationRL</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    root <span class="token operator">=</span> <span class="token function">insertNode</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>可以发现AVL的插入功能在BST的基础上加入了对数据高度的判断以及对旋转策略的判断，其中对旋转与否的决策通过<code>heightNode</code>函数进行，其具体实现如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">heightNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>由于插入数据是递归进行的，而决策旋转的程序在递归函数后(在16行后)，也就是说我们会在向上回溯的过程中进行旋转。由于我们是在插入数据90后导致了树的不平衡，所以我们就从90开始向上跟随回溯进行分析：</p> <img src="/avl3.png" style="width:70%;"> <p>插入90(element)首先触发第15行的判断，由于90大于80(node.key)，执行<code>insertNode</code>函数，由于80的右侧原本没有数据(满足node.right==null)，那么就将新的节点90插入80右侧，然后<code>insertNode</code>函数执行完毕，继续执行接下来的语句(18行)，此时的node为80，由于执行<code>heightNode(node.left)</code>语句的时候<code>node.left</code>为null所以返回-1，而执行<code>heightNode(node.right)</code>的时候node.right为90，所以在heightNode函数内部进行一轮递归，查看90左右两边的节点情况(90为heightNode内部的node)，由于90左右都为null所以返回两个-1，然后取两个-1中最大的一个当然还是-1然后-1+1=0就是<code>heightNode(node.right)</code>返回的值了，接下来继续看18行，我们将对两个<code>heightNode</code>返回的值做差，也就是0-(-1)=1即我们得到的数据相对深度，因为这个值没有大于1所以是不激活旋转的。</p> <p>没有旋转是因为过程还没有进行到位，我们只是对插入过程中第一个过程的回溯进行了分析，事实上我们需要回溯三次，按照80-&gt;70-&gt;50的顺序进行，当然我们不能每次回溯都分析一波代码，为了读者易于理解，我进行了一次归纳，每次回溯到的节点命名为<code>node</code>那么这个节点的直接子节点为<code>近node节点</code>例如80为<code>node</code>90为80的<code>近node节点</code>，我们分析的时候需要从底部的节点开始分析，<code>近node节点</code>的子节点如果为null则返回-1否则返回一个经过<code>heightNode</code>递归得到的值，而两个<code>近node节点</code>做差得到最终结果。</p> <p>我们分析<code>node</code>为70的情况，也是从底部开始分析，90左右为null返回两个-1然后max(-1,-1)+1=0，80左侧为null返回-1右侧90将刚才得到的0返回然后max(-1,0)+1=1，60左右为null返回max(-1,-1)+1=0，由于60和80都是70的<code>近node节点</code>所以它们做差1-0=1所以还是不满足旋转条件。</p> <p>最后我们分析<code>node</code>为50的情况，为了减轻阅读负担，我通过图片进行解释：</p> <img src="/avl4.png" style="width:100%;"> <h2 id="平衡删除数据"><a href="#平衡删除数据" aria-hidden="true" class="header-anchor">#</a> 平衡删除数据</h2> <p>平衡后的树是这样的：</p> <img src="/avl2.png" style="width:60%;"> <p>我们在已经平衡的树上进行删除操作：</p> <img src="/avl5.png" style="width:60%;"> <p>我们删除了节点90和80，这将导致树左侧的节点深度大于右侧，激活右单旋转(LL)，我们先请出删除节点的模块：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> parentNode<span class="token punctuation">;</span>
<span class="token keyword">var</span> nodeToBeDeleted<span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">removeNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    parentNode <span class="token operator">=</span> node<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">removeNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        nodeToBeDeleted <span class="token operator">=</span> node<span class="token punctuation">;</span>
        node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">removeNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 测试输出</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parentNode<span class="token punctuation">.</span>key<span class="token punctuation">,</span>nodeToBeDeleted<span class="token punctuation">.</span>key<span class="token punctuation">,</span>node<span class="token punctuation">.</span>key<span class="token punctuation">,</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">===</span> parentNode<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//remove node</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeToBeDeleted <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> element <span class="token operator">==</span> nodeToBeDeleted<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeToBeDeleted <span class="token operator">===</span> parentNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                node <span class="token operator">=</span> node<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> tmp <span class="token operator">=</span> nodeToBeDeleted<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
                nodeToBeDeleted<span class="token punctuation">.</span>key <span class="token operator">=</span> parentNode<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
                parentNode<span class="token punctuation">.</span>key <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
                node <span class="token operator">=</span> node<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//do balancing</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>left <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>right <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>left<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                node <span class="token operator">=</span> <span class="token function">rotationLR</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                node <span class="token operator">=</span> <span class="token function">rotationLL</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">heightNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&gt;</span> node<span class="token punctuation">.</span>right<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                node <span class="token operator">=</span> <span class="token function">rotationRL</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                node <span class="token operator">=</span> <span class="token function">rotationRR</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parentNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    nodeToBeDeleted <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    root <span class="token operator">=</span> <span class="token function">removeNode</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>这是平衡删除后节点的输出结果：</p> <img src="/avl6.png" style="width:100%;"> <p>删除节点的过程是递归到目标节点，然后删除该节点，必要时将在回溯的过程中平衡树(15行以后的程序都是在回溯过程中进行的)，删除节点90时进行了三次回溯，通过我们在16行设置的变量监听给出的数据：</p> <table><thead><tr><th>parentNode</th> <th>nodeToBeDeleted</th> <th>node</th> <th>element</th></tr></thead> <tbody><tr><td>90</td> <td>90</td> <td>90</td> <td>90</td></tr> <tr><td>90</td> <td>90</td> <td>80</td> <td>90</td></tr> <tr><td>90</td> <td>90</td> <td>70</td> <td>90</td></tr></tbody></table> <p><code>node === parentNode</code>是处理访问到目标节点的情况(从null回溯到90的时候访问到目标节点90)，之后的处理(29行以后)则是对旋转的判定和执行，原理和插入时的旋转相同，由于删除90不会激活旋转，所以是在删除80的时候执行的</p> <h2 id="小结"><a href="#小结" aria-hidden="true" class="header-anchor">#</a> 小结</h2> <p>AVL是基于BST开发的可自动根据数据深度情况进行平衡的二叉树，数据的平衡处理主要伴随着数据插入和删除进行，而且插入和删除时发生的平衡活动都是在回溯的时候进行的。代码中还存在部分处理特殊情况的程序，将不会一一进行解析。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/index/data/bst.html" class="prev">
          二叉搜索树
        </a></span> <span class="next"><a href="/index/C++/STL_Container.html">
          STL容器
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d3fbac6e.js" defer></script><script src="/assets/js/2.8a2063c8.js" defer></script><script src="/assets/js/5.b2285a0a.js" defer></script>
  </body>
</html>
